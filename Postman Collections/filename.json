{
	"info": {
		"_postman_id": "c8111e46-963d-4f41-9da4-d5f9cf11bd05",
		"name": "Test_Place_Bet",
		"schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
	},
	"item": [
		{
			"name": "Login",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "dc2aa49f-4dc6-4603-9422-a80f711b095e",
						"exec": [
							"// Set Barrier Token To Environment Variable\r",
							"var jsonData = JSON.parse(responseBody);\r",
							"pm.environment.set(\"tmpAUTH_TOKEN\", \"bearer \"+ jsonData.result.access_token);\r",
							"\r",
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"postman.setNextRequest(\"SetRealBalanceUse\");\r",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"id": "328b25a9-fb85-419f-9e54-afb8272a49a7",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "sitename",
						"value": "{{SiteName}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"userName\": \"am11_1\",\r\n    \"password\": \"Abc@123\",\r\n    \"deviceinfo\": \"strModel:vivo - vivo 1716\"\r\n}\r\n",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": "{{HOST_URL}}Account/AppLogin"
			},
			"response": []
		},
		{
			"name": "SetRealBalanceUse",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "575ad641-0d5b-4adf-92ec-560c8c6971b4",
						"exec": [
							"postman.setNextRequest(\"ActiveMarketList\");\r",
							"\r",
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"id": "30d0d60a-40c7-410f-8fdb-e12ae39ea7c3",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "{{tmpAUTH_TOKEN}}",
						"type": "text"
					}
				],
				"url": "{{HOST_URL}}Account/SetRealBalanceUse"
			},
			"response": []
		},
		{
			"name": "ActiveMarketList",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "3332e214-42ab-4089-8b56-20dfbefe35aa",
						"exec": [
							"// Set Match (Event) Id Into Environment Variable\r",
							"var jsonData = JSON.parse(responseBody);\r",
							"var getmatchid = jsonData.result;\r",
							"var matchedIds = [];\r",
							"var BetID = [];\r",
							"\r",
							"getmatchid.forEach(function(item) {\r",
							"    if (item.mn === \"TO WIN THE TOSS\") {\r",
							"        BetID.push(item.mid);\r",
							"        matchedIds.push(item.eid);\r",
							"    }\r",
							"});\r",
							"pm.environment.set(\"tmpBet_IDs\", JSON.stringify(BetID));\r",
							"pm.environment.set(\"tmpMatch_IDs\", JSON.stringify(matchedIds));\r",
							"\r",
							"postman.setNextRequest(\"GetMatchwiseMarketinfo\");"
						],
						"type": "text/javascript"
					}
				}
			],
			"id": "e75fca7e-491b-446f-86ff-610480e7c6b6",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "{{tmpAUTH_TOKEN}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": []
				},
				"url": "{{HOST_URL}}Market/ActiveMarketList"
			},
			"response": []
		},
		{
			"name": "GetMatchwiseMarketinfo",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "e053f400-4922-4942-b438-f3b30065d0f0",
						"exec": [
							"// Set Bet Id In Environment variable\r",
							"var match_id = pm.environment.get(\"tmpBet_IDs\");\r",
							"var array = JSON.parse(\"[\" + match_id + \"]\");\r",
							"pm.environment.set(\"tmpBet_ID\", array[0][0]);\r",
							"\r",
							"// var i = 0;\r",
							"// while(i<array[0].length ){\r",
							"//     postman.setNextRequest(\"GetMatchwiseMarketinfo\");\r",
							"//     var demo = JSON.parse(\"[\" + match_id + \"]\");\r",
							"//     arrayvalue = demo[0][i]\r",
							"//     console.log(arrayvalue)\r",
							"//     if (pm.response.to.have.status(200))\r",
							"//     {\r",
							"//         if (arrayvalue)\r",
							"//         {\r",
							"//             postman.setNextRequest(\"GetEventWiseMarketInfo\");\r",
							"//             break\r",
							"//         }\r",
							"//     }    \r",
							"//     i++;\r",
							"// }\r",
							"\r",
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							""
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "1084b937-819d-472b-bc28-3c3137b1f5fa",
						"exec": [
							"// console.log(pm.environment.get(\"tmpMatch_IDs\"));\r",
							"var match_id = pm.environment.get(\"tmpMatch_IDs\")\r",
							"var array = JSON.parse(\"[\" + match_id + \"]\");\r",
							"pm.environment.set(\"tmpMatch_ID\", array[0][1])\r",
							"// pm.environment.get(\"variable_key\");"
						],
						"type": "text/javascript"
					}
				}
			],
			"id": "821d0e29-dbc3-43a9-ba4d-6e29adba43e5",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "{{tmpAUTH_TOKEN}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{HOST_URL}}Market/GetMatchWiseMarketInfo?matchId={{tmpMatch_ID}}",
					"host": [
						"{{HOST_URL}}Market"
					],
					"path": [
						"GetMatchWiseMarketInfo"
					],
					"query": [
						{
							"key": "matchId",
							"value": "{{tmpMatch_ID}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "GetEventWiseMarketInfo",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "0b7f0c8f-be7d-4bcd-9fc0-7d3746f3c5fc",
						"exec": [
							"var jsonData = JSON.parse(responseBody);\r",
							"var getmatchid = jsonData.result;\r",
							"var runinfo = getmatchid.runnerInfo;\r",
							"pm.environment.set(\"tmpBetDetailID\", JSON.stringify(runinfo[3].rid));\r",
							"\r",
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"postman.setNextRequest(\"Balance\");\r",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"id": "95736c95-6c54-4352-87ca-5caa0c15c650",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "{{tmpAUTH_TOKEN}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{HOST_URL}}Market/GetEventWiseMarketInfo?matchId={{tmpMatch_ID}}",
					"host": [
						"{{HOST_URL}}Market"
					],
					"path": [
						"GetEventWiseMarketInfo"
					],
					"query": [
						{
							"key": "matchId",
							"value": "{{tmpMatch_ID}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Balance",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "28362048-d774-4d36-8dc7-4591663d0504",
						"exec": [
							"var tmp = JSON.parse(responseBody);\r",
							"\r",
							"var result = tmp.result;\r",
							"var tmpbalance = result.balance;\r",
							"var tmpliability = result.liability;\r",
							"\r",
							"pm.environment.set(\"tmpbalance\", tmpbalance);\r",
							"pm.environment.set(\"tmpliability\", tmpliability);\r",
							"\r",
							"postman.setNextRequest(\"PlaceBet\");\r",
							"\r",
							""
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "b2bda4ab-0ebd-4ae7-824d-a20f1c5a4a01",
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"id": "c5cd7009-c402-4d2a-9f88-598642fbccab",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "{{tmpAUTH_TOKEN}}",
						"type": "text"
					}
				],
				"url": "{{HOST_URL}}Chip/Client/Balance"
			},
			"response": []
		},
		{
			"name": "PlaceBet",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "e95a9051-4468-4fa9-bfcb-0671d023d00b",
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.environment.set(\"tmpstake\", pm.environment.get(\"tmpstake\"))\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"pm.test(\"Bet has been placed successfully\", function () {\r",
							"    pm.expect(pm.response.text()).to.include(\"true;Bet has been placed successfully.\");\r",
							"});\r",
							"\r",
							"// console.log(pm.response.text());\r",
							"// var match_id = pm.environment.get(\"tmpBet_IDs\");\r",
							"// var array = JSON.parse(\"[\" + match_id + \"]\");\r",
							"// var i = 0;\r",
							"// var requestBody = pm.request.body.raw;\r",
							"// pm.environment.set(\"tmprequestBody\", requestBody);\r",
							"postman.setNextRequest(\"UpdatedBalance\");"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "b0abcc27-7a8e-4d82-9ba1-bffee5120537",
						"exec": [
							"pm.environment.set(\"tmpstake\", 100);"
						],
						"type": "text/javascript"
					}
				}
			],
			"id": "e228e3ac-88e1-4918-ad2c-dcda62374ffc",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "{{tmpAUTH_TOKEN}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n  \"BetId\": {{tmpBet_ID}},\r\n  \"BetDetailId\": {{tmpBetDetailID}},\r\n  \"IsBack\": true,\r\n  \"Rate\": 1.97,\r\n  \"Stake\": {{tmpstake}},\r\n  \"Fancytype\": 10,\r\n  \"Point\": 1.97,\r\n  \"placeFrom\": 1,\r\n  \"deviceinfo\": \"browser=Chrome:: device=Desktop:: os=Windows:: latitude=0 :: longitude=0\",\r\n  \"isWager\": false\r\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": "{{HOST_URL}}Bet/PlaceBet"
			},
			"response": []
		},
		{
			"name": "UpdatedBalance",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "53c0a727-4b20-4809-9249-9aade8fbdf9b",
						"exec": [
							"var response = JSON.parse(responseBody);\r",
							" \r",
							"var balance = pm.environment.get(\"tmpbalance\");\r",
							"var stake = pm.environment.get(\"tmpstake\");\r",
							"var liability = pm.environment.get(\"tmpliability\");\r",
							"var result = response.result;\r",
							"var tmpupdatebalance = balance - stake;\r",
							"var tmpupdateliability = liability - stake;\r",
							"console.log(tmpupdatebalance)\r",
							"pm.test(\"Wallet balance is Updated\", function(){\r",
							"\tpm.expect(result.balance).to.eql(tmpupdatebalance)\r",
							"});\r",
							"\r",
							"pm.test(\"Liability is Updated\", function(){\r",
							"\tpm.expect(result.liability).to.eql(tmpupdateliability)\r",
							"});\r",
							""
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "22397ade-03fd-42f0-a603-d07d40b966f6",
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"id": "991152ab-f5a4-4460-a9c6-19e68c4d5cd1",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "{{tmpAUTH_TOKEN}}",
						"type": "text"
					}
				],
				"url": "{{HOST_URL}}Chip/Client/Balance"
			},
			"response": []
		},
		{
			"name": "GetallBetList",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "e6873ffb-b416-455c-a74a-b8030776c359",
						"exec": [
							"// var betid = pm.environment.get(\"tmpBet_ID\");\r",
							"// var betdetailid = pm.environment.get(\"tmpBetDetailID\");\r",
							"// var stake = pm.environment.get(\"tmpstake\");\r",
							"// var auth = pm.environment.get(\"tmpAUTH_TOKEN\");\r",
							"// var requestBody = pm.environment.get(\"tmprequestBody\");\r",
							"// var myJSON = JSON.parse(requestBody);\r",
							"\r",
							"// var match_id = pm.environment.get(\"tmpBet_IDs\");\r",
							"// var array = JSON.parse(\"[\" + match_id + \"]\");\r",
							"// console.log(array[0][1])\r",
							"// var i = 0;\r",
							"// while(i < array[0].length ){\r",
							"    \r",
							"//     var requestData = {\r",
							"//         // Add request data here\r",
							"//         // For example:\r",
							"//         method: \"POST\",\r",
							"//         url: \"https://uatapib2c.cloudd.live/api/Bet/PlaceBet\",\r",
							"//         header:{\r",
							"//             Authorization: auth\r",
							"//         },\r",
							"//         body: myJSON\r",
							"//     };\r",
							"\r",
							"//     postman.setNextRequest(\"PlaceBet\");\r",
							"//     pm.sendRequest(requestData, function (err, response) {\r",
							"//         // console.log(array[i]);\r",
							"//     if (response.text().includes(\"successfully\")){\r",
							"//         i = array[0].length; // break out of the loop    \r",
							"//     }\r",
							"//     });\r",
							"//     i++;\r",
							"// }\r",
							"// console.log(myJSON)\r",
							"\r",
							"function cleanup() {\r",
							"    const clean = _.keys(pm.environment.toObject())\r",
							"    _.each(clean, (arrItem) => {\r",
							"        if (arrItem.startsWith(\"tmp\")) {\r",
							"            pm.environment.unset(arrItem)\r",
							"        }\r",
							"    })\r",
							"};\r",
							"cleanup()\r",
							""
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "11e67e15-ba9d-4af6-9230-aa5d70e3b39d",
						"exec": [
							"pm.environment.set(\"tmpstake\", 100);"
						],
						"type": "text/javascript"
					}
				}
			],
			"id": "16e0191e-cb06-49d4-8b6c-18064367ae1a",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "{{tmpAUTH_TOKEN}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": "{{HOST_URL}}Market/GetAllBetList"
			},
			"response": []
		}
	]
}